<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=4, minimum-scale=1,user-scalable=yes">
    <meta content="email=no" name="format-detection" />
    <title>基本信息</title>
    <!-- <script>
  document.documentElement.style.fontSize = document.documentElement.clientWidth / 7.5 + 'px';
</script> -->
    <style>
        .notice-subject {
            padding: .3rem 0;
            text-align: center;
            font-weight: bold;
            color: #f2655d;
            /* font-size: .3rem; */
        }

        table {
            /* border: 1px solid black; */
            border-collapse: collapse;
            /* width: 100%; */
            /* margin: 0; */
            /* table-layout: fixed; */
            display: table;
            margin: 0 auto;
            width: 98%;
            line-height: 1.4rem;
        }

        #type-two-border td {
            border: 1px solid #f2655d;
        }

        #type-two-border img {
            width: 100%;
        }

        .title-red {
            color: red;
            border-bottom: 3px solid red;

        }

        .leader-title {
            width: 25%;
            text-align: center;
            padding: 0.2rem;
            font-size: .9rem;
            color: #f2655d;
        }

        .leader-content {
            text-align: center;
            padding: 0.2rem;
            font-size: .9rem;
        }
        /*操作按钮*/
        /* .foot-btn{height: 3rem;position: fixed;bottom: 0;left: 0;width: 100%;border-top: 1px solid #ccc;background: #fff; color: #A1A1A3;}
        .bottom-nav-box{height: 3rem;display: inline-block;width: 33.33%;text-align: center;line-height: 3rem;}
        .bottom-nav-box>span.rjicon{font-size: 1.2rem;position: relative;display: block;line-height: 1.5rem;padding-top: .2rem;}
        .bottom-nav-box>span:nth-child(2){position: relative;top: -1rem;line-height: 1.2rem;height: 1rem;font-size: .8rem;} */
        .more-btn{
            position:fixed;
            left: 66.66%;
            top:auto;
            bottom: 3rem;
            width: 33.33%;
            height: auto;
            color:#7B86EC;
        }
        .van-popup--center {
            /* top: 0; */
            -webkit-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0); 
        }
        .van-cell{
            font-size: .8rem;
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="meeting" class="page-view">
        <div style="height: 100%;width: 100%;">
            <div id="text6" style="height: 100%;width: 100%;overflow: hidden;
   overflow-y: auto;">
                <!-- 办公用品 -->
                <div id="type-two-border" style="margin-top: 1rem;" v-if="module == 'goods'">
                    <div class="notice-box">
                        <div class="notice-subject">{{docInfor.businessSubject}}</div>
                        <div>
                            <table class="meeting-table">
                                <tr>
                                    <td class="leader-title">申请类型:</td>
                                    <td class="leader-content" colspan="7">{{docInfor.goodsType
                                        =='0'?'办公用品申领':'办公耗材申领'}}</td>
                                </tr>
                                <tr>
                                    <td class="leader-title">申请日期:</td>
                                    <td class="leader-content" colspan="7">{{docInfor.applyDate}}</td>
                                </tr>
                                <tr>
                                    <td class="leader-title">申请人:</td>
                                    <td class="leader-content" colspan="7">{{docInfor.userName}}</td>
                                </tr>
                                <tr>
                                    <td class="leader-title">申请部门:</td>
                                    <td class="leader-content" colspan="7">{{docInfor.applyDeptName}}</td>
                                </tr>
                                <tr>
                                    <td class="leader-title" style="width: 20%;">序号</td>
                                    <td class="leader-title" style="width: 20%;">类型</td>
                                    <td class="leader-title" style="width: 20%;">品名</td>
                                    <td class="leader-title" style="width: 20%;">规格型号</td>
                                    <td class="leader-title" style="width: 20%;">申领数量</td>
                                    <td class="leader-title" style="width: 20%;">单位</td>
                                    <td class="leader-title" style="width: 20%;">库存数量</td>
                                    <td class="leader-title" style="width: 20%;">备注</td>
                                </tr>
                                <template v-for="(obj,y) in docInfor.useRecordList">
                                    <tr>
                                        <td class="leader-content" style="width: 20%;">{{y + 1}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.goodsTypeName}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.goodsName}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.formatPattern}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.applyNumber}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.unit}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.reserveNumber}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.remark}}</td>
                                    </tr>
                                </template>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- 办公耗材 -->
                <div id="type-two-border" style="margin-top: 1rem;" v-if="module == 'supplies'">
                    <div class="notice-box">
                        <div class="notice-subject">{{docInfor.businessSubject}}</div>
                        <div>
                            <table class="meeting-table">
                                <tr>
                                    <td class="leader-title">申请类型:</td>
                                    <td class="leader-content" colspan="7">{{docInfor.goodsType
                                        =='0'?'办公用品申领':'办公耗材申领'}}</td>
                                </tr>
                                <tr>
                                    <td class="leader-title">申请日期:</td>
                                    <td class="leader-content" colspan="7">{{docInfor.applyDate}}</td>
                                </tr>
                                <tr>
                                    <td class="leader-title">申请人:</td>
                                    <td class="leader-content" colspan="7">{{docInfor.userName}}</td>
                                </tr>
                                <tr>
                                    <td class="leader-title">申请部门:</td>
                                    <td class="leader-content" colspan="7">{{docInfor.applyDeptName}}</td>
                                </tr>
                                <tr>
                                    <td class="leader-title" style="width: 20%;">序号</td>
                                    <td class="leader-title" style="width: 20%;">类型</td>
                                    <td class="leader-title" style="width: 20%;">品名</td>
                                    <td class="leader-title" style="width: 20%;">规格型号</td>
                                    <td class="leader-title" style="width: 20%;">申领数量</td>
                                    <td class="leader-title" style="width: 20%;">单位</td>
                                    <td class="leader-title" style="width: 20%;">库存数量</td>
                                    <td class="leader-title" style="width: 20%;">备注</td>
                                </tr>
                                <template v-for="(obj,y) in docInfor.useRecordList">
                                    <tr>
                                        <td class="leader-content" style="width: 20%;">{{y + 1}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.goodsTypeName}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.goodsName}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.formatPattern}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.applyNumber}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.unit}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.reserveNumber}}</td>
                                        <td class="leader-content" style="width: 20%;">{{obj.remark}}</td>
                                    </tr>
                                </template>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- <div id="FileBtn" class="foot-btn" :style="moreBtn?'height:auto':''">
                <div class="bottom-nav-box" v-for="item in detailPage.btnArrs"
                    @click="detailPage.toEvents(item.toEvent,$event)"><span class="rjicon"
                        :class="item.iconCss"></span><span v-cloak>{{item.btnName}}</span></div>
            </div> -->
            <div id="FileBtn" v-if="detailPage.btnArrs.length>0" class="foot-btn" :style="moreBtn?'height:auto':''">
				<template v-for="(item,i) in detailPage.btnArrs">
					<div class="bottom-nav-box"   @click="detailPage.toEvents(item.toEvent,$event)" v-show="detailPage.btnArrs.length <= 3 || (detailPage.btnArrs.length >3 && i < 2)"><span class="rjicon" :class="'rjicon-' + item.iconCss"></span><span v-cloak>{{item.btnName}}</span></div>
				</template>
				<div class="bottom-nav-box"  @click="detailPage.showGengduo" v-show="detailPage.btnArrs.length > 3"><span class="rjicon icon-gengduo" ></span><span v-cloak>更多</span></div>
				
			</div>
			<div id="gengduo" ></div>
			<van-popup id="popup-gengduo" v-model="detailPage.isShowGengduoMenu" get-container="#gengduo" class="more-btn">
				<div v-for="(item,i) in detailPage.btnArrs">
					<van-cell style="color:#7B86EC;" center :title="item.btnName" icon-prefix="rjicon" :icon="item.iconCss" v-show="i >= 2"  @click="toEvents(item.toEvent,$event)"/>
				</div>
			</van-popup>
        </div>
    </div>
    <script>
        var vFlow = new Vue({
            el: '#meeting',
            data() {
                return {
                    docInfor: JSON.parse(App.LS.get("docInfor")),
                    module: App.LS.get("module"),
                    moreBtn: false,
                }
            },
            mounted: function () {
                console.log(this.docInfor)
            },
            created: function () {
                this.loading = true;
                baseCommon.getOpinionList();
            },
            methods: {
                replace: function (content) {
                    content = content.replace('text-indent:272pt;', 'text-align: right;');
                    content = content.replace('text-indent:264pt;', 'text-align: right;');
                    return content;
                },
                getFileIcon: function (fileSuffix) {
                    switch (fileSuffix) {
                        case "wps":
                            return "wps"
                            break;
                        case "doc":
                        case "docx":
                            return "word"
                            break;
                        case "xls":
                        case "xlsx":
                            return "excel"
                            break;
                        case "pdf":
                            return "pdf"
                            break;
                        case "ppt":
                            return "ppt"
                            break;
                        case "jpg":
                        case "jpeg":
                        case "png":
                            return "jpg"
                            break;
                        default:
                            return "qita"
                    }
                },
                getFileTask: function (fileSuffix) {
                    var fileTask = "";
                    if (fileSuffix.indexOf('doc') > -1) {
                        fileTask = "word2PDF"
                    } else if (fileSuffix.indexOf('wps') > -1) {
                        fileTask = "wps2PDF";
                    } else if (fileSuffix.indexOf('xls') > -1) {
                        fileTask = "excel2PDF";
                    } else if (fileSuffix.indexOf('ppt') > -1) {
                        fileTask = "ppt2PDF";
                    } else if (fileSuffix.indexOf('pdf') > -1) {
                        fileTask = "none";
                    } else if (fileSuffix.indexOf('jpg') > -1) {
                        fileTask = "jpg2PDF";
                    } else if (fileSuffix.indexOf('jpeg') > -1) {
                        fileTask = "jpg2PDF";
                    } else if (fileSuffix.indexOf('gif') > -1) {
                        fileTask = "gif2PDF";
                    } else if (fileSuffix.indexOf('png') > -1) {
                        fileTask = "png2PDF";
                    } else if (fileSuffix.indexOf('txt') > -1) {
                        fileTask = "txt2PDF";
                    } else {
                        fileTask = 1;
                    }
                    return fileTask;
                },
                initFileList: function (type) {
                    var _this = this;
                    $.each(fileLists[type], function (i, item) {
                        item.url = item.URL;
                        item.fileSuffix = (item.title.substring(item.title.lastIndexOf('.') + 1)).toLowerCase();
                        item.fileTask = _this.getFileTask(item.fileSuffix);
                        if (item.fileTask == 1) {
                            item.fcsUrl = fcsurl + 'fileurl=' + encodeURIComponent(item.url) + '&task=none&type=src&res=url&filetype=' + item.fileSuffix + '&jsoncallback=?';
                        } else {
                            item.fcsUrl = fcsurl + 'fileurl=' + encodeURIComponent(item.url) + '&task=' + item.fileTask + '&type=src&res=url&filetype=' + item.fileSuffix + '&jsoncallback=?';
                        }
                        item.fcsTransTime = 0;
                        item.fileType = type;
                        item.pdfurl = '';
                        item.index = i;
                        item.autoflag = false;
                        console.log(item);
                        _this.getPdfUrl(item);
                    })
                },
                fcsError: function (fileObj) {
                    if (fileObj.autoflag && fileObj.fcsTransTime == 3) {
                        toast("转换失败，重新发起.");
                        fileObj.pdfurl = "converFail";
                    } else if (fileObj.autoflag) {
                        this.getPdfUrl(fileObj);
                    }
                },
                getPdfUrl: function (fileObj) {
                    var _this = this;
                    // console.info(_url)
                    //ajaxRequst(_url,'post','application/x-www-form-urlencoded','text',obj).then(function(json){
                    ajaxRequst({
                        type: "GET",
                        url: fileObj.fcsUrl,
                        dataType: "jsonp",
                        jsonp: "jsoncallback"
                    }, function (result) {
                        fileObj.fcsTransTime++;
                        console.info(result)
                        if (result == "converFail" || result.Success === 'False' || result.Content === 'null') {
                            fcsError(fileObj);
                        } else {
                            //autoflag=true;
                            fileObj.pdfurl = fcsFilePath + result.Content;
                            if (fileObj.autoflag) {
                                _this.openFile(fileObj);
                            }
                        }

                    }, function (error) {
                        console.log(JSON.parse(error.responseText));
                        var _error = JSON.parse(error.responseText);
                        // toast(_error.msg)
                        //								try{wispApp.UI.dismissProgressDialog();}catch(e){}
                        toast("数据加载出错，请刷新重试！");
                        //								console.log(error);
                    }
                    )
                },
                openFile: function (fileObj) {
                    console.dir(fileObj)
                    var _self = this;
                    if (fileObj.pdfurl != "" && fileObj.pdfurl != "converFail") {
                        if (fileObj.fileTask == 1) {//不转换的情况
                            try {
                                var fileJson = { userName: App.LS.get("LastName"), isRead: true }
                                wispApp.H5plus.downloaFile(fileObj.pdfurl, {}, fileJson, function (filePath, fileProperty) {
                                    //alert("filePath:"+filePath);
                                    try { wispApp.UI.dismissProgressDialog(); } catch (e) { }
                                    if (/edc|bdc/i.test(fileObj.fileSuffix) && /Android/i.test(navigator.userAgent)) {
                                        var actionName = "android.intent.action.kinsecSignFile";
                                        var sd_path = plus.io.convertLocalFileSystemURL(filePath);
                                        var optionsJson = [{ openFile: sd_path, saveFile: "", screen: "all" }];
                                        wispApp.App.openapp("", "", actionName, optionsJson);
                                    } else {
                                        wispApp.App.openfile(filePath, {}, fileListPage.openErrorCallbak);
                                    }
                                    /*plus.runtime.openFile(filePath,{},function(error){
                                        wispApp.UI.showToast(error.message);
                                    });*/
                                });
                            } catch (e) { alert(e) }
                        } else {
                            //window.open('./pdfh5/pdfh5.html?fileUrl='+fileObj.pdfurl+'&fileTitle='+fileObj.title)  
                            wispApp.H5plus.creatWebview('./pdfh5/pdfh5.html?fileUrl=' + fileObj.pdfurl + '&fileTitle=' + fileObj.title + '&ver=' + App.LS.get('appRes'), 'fileRead', '文件');
                        }
                    } else if (fileObj.pdfurl == "") {
                        this.getPdfUrl(fileObj);
                    }

                },
                openErrorCallbak: function (error) {
                    wispApp.UI.showToast(error.message);
                }
            }
        });
    </script>
</body>

</html>